<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Room Detail</title>
  <link rel="stylesheet" href="/CSS/detail.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="/JS/script.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <a href="/HTML/homeaccount.html"><img class="back" src="img/Vector.png" alt="Back"></a>
  <div class="container">
      <div class="img">
        <img src="/HTML/img/detallreoom.svg.svg" alt="Room Image">
      </div>
      <h2 id="room-title"></h2>
      <h3 id="room-price"></h3>
     3>‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô</h3>
      <li>‡∏Ç‡∏ô‡∏≤‡∏î: 1 ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 3x4 ‡πÄ‡∏°‡∏ï‡∏£)</li>
      <li>‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå: ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏Ç‡∏ô‡∏≤‡∏î 5 ‡∏ü‡∏∏‡∏ï, ‡∏ï‡∏π‡πâ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤, ‡πÇ‡∏ï‡πä‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏õ‡πâ‡∏á</li>
      <li>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</li>
      <h3>‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥</h3>
      <li>‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å: ‡πÇ‡∏ñ‡∏™‡∏∏‡∏Ç‡∏†‡∏±‡∏ì‡∏ë‡πå, ‡∏ù‡∏±‡∏Å‡∏ö‡∏±‡∏ß, ‡∏≠‡πà‡∏≤‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤</li>
      <li>‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô</li>
      <h3>‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</h3>
      <li>‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡πÅ‡∏™‡∏á</li>
      <li>‡∏û‡∏∑‡πâ‡∏ô‡∏õ‡∏π‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏∞‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á</li>
      <li>‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥</li>
      <h3>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</h3>
      <li>‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ</li>
      <li>‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏Å‡∏ú‡πâ‡∏≤</li>
      <div class="price">
        <span id="room-final-price"></span>
        <button id="bookButton" class="btn">‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
      </div>
  </div>
  <div> </div>
  <div id="moveout-popup" class="popup">
    <span class="close" onclick="closePopup()">&times;</span>
    <h4>‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</h4>
    <div class="btn-g-popup">
       <label for="name">‡∏ä‡∏∑‡πà‡∏≠</label><br>
       <input type="text" id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á"><br>
       <label for="lastname">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><br>
       <input type="text" id="lastname" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"><br>
       <label for="address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label><br>
       <textarea class="textarea" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô"></textarea><br>
       <img src="/HTML/img/‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î.png" alt=""><br>  
       <label for="paymentSlip">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</label><br>
       <input type="file" id="paymentSlip"><br>
       <button id="confirmBooking" class="btn btn-pop">‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
    </div>
  </div>
  <div id="successPopup" class="success-popup">
    üéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß
    <div id="qr-code-container"></div> <!-- ‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå QR Code ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
  </div>
  
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const roomNumber = urlParams.get("room") || "1";
    const roomPrice = {"101": 3500, "102": 3500, "103": 3500}[roomNumber] || 3500;

    document.getElementById("room-title").textContent = `Room ${roomNumber} ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î`;
    document.getElementById("room-price").textContent = `‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤ ${roomPrice} ‡∏ö‡∏≤‡∏ó`;
    document.getElementById("room-final-price").textContent = `${roomPrice} baht`;

    const bookButton = document.getElementById("bookButton");
    if (localStorage.getItem(`room_${roomNumber}`) === "booked") {
      bookButton.textContent = "‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß";
      bookButton.disabled = true;
    } else {
      bookButton.addEventListener("click", () => {
        document.getElementById("moveout-popup").style.display = "block";
      });
    }

    function closePopup() {
      document.getElementById("moveout-popup").style.display = "none";
    }

    document.getElementById("confirmBooking").addEventListener("click", () => {
      const name = document.getElementById("name").value;
      const lastname = document.getElementById("lastname").value;
      const fullName = `${name} ${lastname}`;
      const paymentSlip = document.getElementById("paymentSlip").files[0];

      if (!paymentSlip) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô");
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        const paymentSlipData = event.target.result;

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ô LocalStorage
        localStorage.setItem(`room_${roomNumber}`, "booked");
        localStorage.setItem(`room_${roomNumber}_user`, fullName);
        localStorage.setItem(`room_${roomNumber}_paymentSlip`, paymentSlipData);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á)
        const paymentUrl = `https://paymentgateway.com/pay?room=${roomNumber}&amount=${roomPrice}`;

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
        const qrCodeContainer = document.getElementById("qr-code-container");
        qrCodeContainer.innerHTML = "";  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå QR Code ‡πÄ‡∏Å‡πà‡∏≤
        new QRCode(qrCodeContainer, paymentUrl);

        // ‡πÅ‡∏™‡∏î‡∏á popup ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        document.getElementById("successPopup").style.display = "block";

        // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        setTimeout(() => {
          window.location.href = "/login/Room&Rate.html";
        }, 1500);
      };
      reader.readAsDataURL(paymentSlip);
    });
  </script>
</body>
</html>